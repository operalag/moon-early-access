---
phase: 14-menu-gating
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/useEducationStatus.ts
  - src/components/BottomNav.tsx
  - src/components/education/ModuleCard.tsx
  - src/app/education/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can tap 'Net Practice' in bottom nav and arrive at /education"
    - "Menu item shows pulsing indicator when education incomplete AND wallet not connected"
    - "Module 2 and 3 appear locked with lock icon when wallet not connected"
    - "Wallet-locked modules display 'Connect wallet to unlock' teaser"
  artifacts:
    - path: "src/hooks/useEducationStatus.ts"
      provides: "Education status hook for indicator logic"
      exports: ["useEducationStatus"]
    - path: "src/components/BottomNav.tsx"
      provides: "Net Practice tab with conditional indicator"
      contains: "Net Practice"
    - path: "src/components/education/ModuleCard.tsx"
      provides: "Wallet-gated lock state with teaser message"
      contains: "Connect wallet to unlock"
    - path: "src/app/education/page.tsx"
      provides: "Lock reason computation for wallet gating"
      contains: "lockReason"
  key_links:
    - from: "src/components/BottomNav.tsx"
      to: "src/hooks/useEducationStatus.ts"
      via: "useEducationStatus hook import"
      pattern: "useEducationStatus"
    - from: "src/app/education/page.tsx"
      to: "@tonconnect/ui-react"
      via: "useTonAddress for wallet detection"
      pattern: "useTonAddress"
    - from: "src/components/education/ModuleCard.tsx"
      to: "lockReason prop"
      via: "conditional teaser render"
      pattern: "lockReason.*wallet"
---

<objective>
Add "Net Practice" entry point to main navigation with attention indicator and wallet-gated module locking.

Purpose: Complete the v6.0.0 education feature by making it discoverable from main navigation and showing clear wallet-unlock incentives for Modules 2 and 3.

Output:
- New useEducationStatus hook for indicator state
- BottomNav with 5th tab and pulsing indicator
- Enhanced ModuleCard with wallet-lock teaser
- Updated education page with wallet gating
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-menu-&-gating/14-RESEARCH.md

# Key source files
@src/components/BottomNav.tsx
@src/components/education/ModuleCard.tsx
@src/app/education/page.tsx
@src/hooks/useProgression.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useEducationStatus hook and add Net Practice to BottomNav</name>
  <files>
    src/hooks/useEducationStatus.ts
    src/components/BottomNav.tsx
  </files>
  <action>
Create `src/hooks/useEducationStatus.ts`:
- Import useState, useEffect from react
- Import useTelegram from @/hooks/useTelegram
- Import useTonAddress from @tonconnect/ui-react
- Export interface EducationStatus with: isEducationComplete (boolean), isWalletConnected (boolean), shouldShowIndicator (boolean), loading (boolean)
- Implement useEducationStatus hook:
  - Get user from useTelegram()
  - Get walletAddress from useTonAddress()
  - Track isEducationComplete state (default false), loading state (default true)
  - useEffect with user?.id dependency: fetch /api/education/progress?userId={user.id}&moduleId=module-1, set isEducationComplete to !!data.progress?.completed_at, set loading to false in finally
  - Add guard: if (!user?.id) return early (don't fetch)
  - Compute: isWalletConnected = !!walletAddress
  - Compute: shouldShowIndicator = !loading && !isEducationComplete && !isWalletConnected
  - Return { isEducationComplete, isWalletConnected, shouldShowIndicator, loading }

Modify `src/components/BottomNav.tsx`:
- Import GraduationCap from lucide-react
- Import useEducationStatus from @/hooks/useEducationStatus
- Add showIndicator optional boolean to tab type
- Add Net Practice tab to tabs array between News and Settings: { name: 'Net Practice', href: '/education', icon: GraduationCap, showIndicator: true }
- Call useEducationStatus() at top of component to get shouldShowIndicator
- In the Link render, add relative class to the existing className
- After the span (tab name), conditionally render indicator: if tab.showIndicator && shouldShowIndicator, render a div with absolute positioning (absolute -top-0.5 -right-1), w-2 h-2, rounded-full, bg-yellow-500, animate-pulse
  </action>
  <verify>
Run `npx tsc --noEmit` - no type errors.
Visually: Open app, see 5 tabs in bottom nav with "Net Practice" between News and Settings.
If not logged in / no wallet: yellow pulsing dot appears on Net Practice tab.
  </verify>
  <done>
- Net Practice tab visible in BottomNav at position 4 (before Settings)
- Pulsing indicator shows when education incomplete AND wallet not connected
- Indicator hidden when loading, when education complete, or when wallet connected
  </done>
</task>

<task type="auto">
  <name>Task 2: Enhance ModuleCard with wallet-lock teaser and update education page</name>
  <files>
    src/components/education/ModuleCard.tsx
    src/app/education/page.tsx
  </files>
  <action>
Modify `src/components/education/ModuleCard.tsx`:
- Add Wallet icon to lucide-react imports
- Add optional lockReason prop to ModuleCardProps: lockReason?: 'prerequisite' | 'wallet' | null
- Inside cardContent, after the badge pill section (before closing div of flex-1 min-w-0):
  - If lockReason === 'wallet', render teaser div:
    - className="mt-2 flex items-center gap-1.5"
    - Wallet icon: size={12}, className="text-yellow-500/70"
    - span: className="text-[10px] text-yellow-500/70 font-medium", text "Connect wallet to unlock"

Modify `src/app/education/page.tsx`:
- Import useTonAddress from @tonconnect/ui-react
- After progressMap state, call useTonAddress() to get walletAddress
- Compute isWalletConnected = !!walletAddress
- Replace computeIsLocked function with computeLockState that returns { isLocked: boolean, lockReason: 'prerequisite' | 'wallet' | null }:
  - First check prerequisite: if prerequisiteModuleId exists and prereq not completed, return { isLocked: true, lockReason: 'prerequisite' }
  - Then check wallet: if module.id !== 'module-1' AND !isWalletConnected, return { isLocked: true, lockReason: 'wallet' }
  - Otherwise return { isLocked: false, lockReason: null }
- In the module map, call const { isLocked, lockReason } = computeLockState(module.id, module.prerequisiteModuleId)
- Pass lockReason prop to ModuleCard: lockReason={lockReason}
  </action>
  <verify>
Run `npx tsc --noEmit` - no type errors.
Visually:
- With wallet disconnected: Module 2 and 3 show lock icon AND "Connect wallet to unlock" message
- With wallet connected: Module 2 and 3 show normal state (not locked by wallet, may be locked by prerequisite)
- Module 1 never shows wallet-lock teaser (it's the wallet education module)
  </verify>
  <done>
- ModuleCard shows "Connect wallet to unlock" teaser when lockReason is 'wallet'
- Module 2 and 3 are wallet-gated (locked without wallet, regardless of prerequisite)
- Module 1 remains accessible without wallet (it teaches wallet connection)
- Prerequisite locking still works (must complete Module 1 before Module 2)
  </done>
</task>

</tasks>

<verification>
1. Type check: `npx tsc --noEmit` passes
2. Lint check: `npm run lint` passes (if configured)
3. Visual verification:
   - Bottom nav shows 5 tabs: Markets, AI Analyst, News, Net Practice, Settings
   - Tapping Net Practice navigates to /education
   - Pulsing yellow indicator on Net Practice when: education incomplete AND no wallet
   - No indicator when: education complete OR wallet connected
   - Module 2 and 3 show lock + teaser when no wallet
   - Module 1 accessible without wallet
</verification>

<success_criteria>
- NAV-01: User can access "Net Practice" from main navigation menu
- NAV-02: Menu item shows pulsing indicator when education is incomplete AND wallet is not connected
- GATE-01: Module 2 and Module 3 appear visually locked when wallet is not connected
- GATE-02: Locked modules display "Connect wallet to unlock" teaser message
</success_criteria>

<output>
After completion, create `.planning/phases/14-menu-&-gating/14-01-SUMMARY.md`
</output>
