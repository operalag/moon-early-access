---
phase: 12-slide-engine-component
plan: 02
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - src/hooks/useHapticFeedback.ts
  - src/components/education/slides/QuizSlide.tsx
  - src/components/education/SlideEngine.tsx
autonomous: true

must_haves:
  truths:
    - "Correct quiz answer triggers light haptic impact"
    - "Incorrect quiz answer triggers heavy haptic impact"
    - "Correct quiz answer triggers confetti animation"
    - "Incorrect quiz answer does NOT trigger confetti"
    - "Haptic feedback works in Telegram, fails gracefully in browser"
  artifacts:
    - path: "src/hooks/useHapticFeedback.ts"
      provides: "Telegram haptic feedback wrapper with null safety"
      min_lines: 15
      exports: ["useHapticFeedback"]
    - path: "src/components/education/slides/QuizSlide.tsx"
      provides: "Quiz slide with haptic and confetti integration"
      contains: "useHapticFeedback"
    - path: "src/components/education/SlideEngine.tsx"
      provides: "SlideEngine with quiz answer callback that triggers effects"
      contains: "fireConfetti"
  key_links:
    - from: "src/components/education/slides/QuizSlide.tsx"
      to: "src/hooks/useHapticFeedback.ts"
      via: "hook import and usage"
      pattern: "useHapticFeedback"
    - from: "src/components/education/SlideEngine.tsx"
      to: "canvas-confetti"
      via: "confetti function call"
      pattern: "confetti\\("
    - from: "src/hooks/useHapticFeedback.ts"
      to: "src/hooks/useTelegram.tsx"
      via: "webApp.HapticFeedback access"
      pattern: "webApp\\??\\.HapticFeedback"
---

<objective>
Add haptic feedback and confetti celebration to quiz answer interactions.

Purpose: Requirements SLIDE-03 and SLIDE-04 specify that correct answers get light haptic + confetti, wrong answers get heavy haptic without confetti. This creates satisfying tactile and visual feedback for quiz interactions.

Output: useHapticFeedback hook for Telegram haptics, updated QuizSlide with haptic calls, confetti burst on correct answers.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-slide-engine-component/12-RESEARCH.md
@.planning/phases/12-slide-engine-component/12-01-SUMMARY.md

# Files from Plan 12-01
@src/components/education/SlideEngine.tsx
@src/components/education/slides/QuizSlide.tsx

# Existing patterns
@src/hooks/useTelegram.tsx
@src/components/ProgressionCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useHapticFeedback hook</name>
  <files>src/hooks/useHapticFeedback.ts</files>
  <action>
Create a reusable hook for Telegram WebApp haptic feedback with graceful browser fallback.

**useHapticFeedback.ts:**
```typescript
'use client';

import { useTelegram } from './useTelegram';

type ImpactStyle = 'light' | 'medium' | 'heavy' | 'rigid' | 'soft';
type NotificationType = 'success' | 'error' | 'warning';

export function useHapticFeedback() {
  const { webApp } = useTelegram();

  const impactOccurred = (style: ImpactStyle) => {
    if (webApp?.HapticFeedback) {
      webApp.HapticFeedback.impactOccurred(style);
    }
    // Silent fail in browser - no haptic hardware
  };

  const notificationOccurred = (type: NotificationType) => {
    if (webApp?.HapticFeedback) {
      webApp.HapticFeedback.notificationOccurred(type);
    }
  };

  const selectionChanged = () => {
    if (webApp?.HapticFeedback) {
      webApp.HapticFeedback.selectionChanged();
    }
  };

  return { impactOccurred, notificationOccurred, selectionChanged };
}
```

This follows the pattern from RESEARCH.md Pattern 3 (Telegram Haptic Feedback Hook).

Key points:
- Always null-check `webApp?.HapticFeedback` before calling
- Export typed functions for impact, notification, and selection haptics
- Silent fail when running in browser (no console errors)
  </action>
  <verify>
File exists: `ls src/hooks/useHapticFeedback.ts`
TypeScript compiles: `npx tsc --noEmit`
Hook exports correctly: `grep "export function useHapticFeedback" src/hooks/useHapticFeedback.ts`
  </verify>
  <done>
useHapticFeedback hook created with impactOccurred, notificationOccurred, and selectionChanged functions. Gracefully handles browser testing (no Telegram).
  </done>
</task>

<task type="auto">
  <name>Task 2: Add haptics and confetti to quiz answer flow</name>
  <files>src/components/education/slides/QuizSlide.tsx, src/components/education/SlideEngine.tsx</files>
  <action>
Wire haptic feedback and confetti into the quiz answer selection flow.

**Update QuizSlide.tsx:**
1. Import `useHapticFeedback` hook
2. In the answer selection handler:
   - After determining if answer is correct
   - Call `impactOccurred('light')` for correct
   - Call `impactOccurred('heavy')` for incorrect
3. Pass the `isCorrect` boolean up to parent via `onAnswer` callback

**Update SlideEngine.tsx:**
1. Import `confetti` from 'canvas-confetti'
2. Create a `fireConfetti` function following the ProgressionCard.tsx pattern:
   ```typescript
   const fireConfetti = () => {
     const colors = ['#22c55e', '#16a34a', '#15803d']; // Green theme for correct answer
     confetti({
       particleCount: 50,
       spread: 60,
       origin: { x: 0.5, y: 0.6 },
       colors,
       startVelocity: 30,
       gravity: 1.2,
     });
   };
   ```
3. Update `handleQuizAnswer` callback:
   - If `isCorrect === true`, call `fireConfetti()`
   - No confetti for incorrect answers (requirement SLIDE-04)

**Flow:**
1. User taps option in QuizSlide
2. QuizSlide determines correct/incorrect
3. QuizSlide triggers haptic (light for correct, heavy for incorrect)
4. QuizSlide calls onAnswer(isCorrect) to parent
5. SlideEngine.handleQuizAnswer fires confetti if correct

Pattern reference: See RESEARCH.md Pattern 4 (Quiz Feedback with Haptics) and Pattern 5 (Confetti Burst).
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Confetti import exists: `grep "canvas-confetti" src/components/education/SlideEngine.tsx`
Haptic hook used: `grep "useHapticFeedback" src/components/education/slides/QuizSlide.tsx`
  </verify>
  <done>
Correct answers trigger light haptic + confetti. Incorrect answers trigger heavy haptic without confetti. Haptics fail gracefully in browser testing.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. useHapticFeedback hook exists and exports correctly
3. QuizSlide imports and uses useHapticFeedback
4. SlideEngine imports canvas-confetti and has fireConfetti function
5. Flow: correct answer -> light haptic + confetti, incorrect -> heavy haptic only
</verification>

<success_criteria>
- useHapticFeedback hook created with typed haptic functions
- Correct quiz answers trigger: impactOccurred('light') + confetti animation
- Incorrect quiz answers trigger: impactOccurred('heavy') without confetti
- Haptic feedback gracefully fails in browser (no errors)
- Confetti uses green theme colors for correct answers
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/12-slide-engine-component/12-02-SUMMARY.md`
</output>
