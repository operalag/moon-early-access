---
phase: 03-featured-market-gating
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/WalletGateModal.tsx
  - src/components/FeaturedMarketCard.tsx
  - src/app/page.tsx
autonomous: true

must_haves:
  truths:
    - "User without wallet sees lock indicator on Featured Market card"
    - "User without wallet tapping card sees bottom sheet modal"
    - "Modal shows wallet education and +1000 points incentive"
    - "Connect Wallet button triggers TonConnect modal"
    - "User with wallet tapping card opens themoon.business externally"
  artifacts:
    - path: "src/components/WalletGateModal.tsx"
      provides: "Bottom sheet with wallet education and connect CTA"
      exports: ["default"]
      min_lines: 50
    - path: "src/components/FeaturedMarketCard.tsx"
      provides: "Extracted card with locked/unlocked states"
      exports: ["default"]
      min_lines: 40
    - path: "src/app/page.tsx"
      provides: "Dashboard using new FeaturedMarketCard"
      contains: "FeaturedMarketCard"
  key_links:
    - from: "src/components/FeaturedMarketCard.tsx"
      to: "src/components/WalletGateModal.tsx"
      via: "import and render"
      pattern: "import.*WalletGateModal"
    - from: "src/components/FeaturedMarketCard.tsx"
      to: "@tonconnect/ui-react"
      via: "useTonAddress hook"
      pattern: "useTonAddress"
    - from: "src/app/page.tsx"
      to: "src/components/FeaturedMarketCard.tsx"
      via: "import and render"
      pattern: "import.*FeaturedMarketCard"
---

<objective>
Implement wallet gating for the Featured Market card on the dashboard.

Purpose: Gate access to external prediction markets behind wallet connection, providing education and incentive to connect.

Output:
- WalletGateModal component (bottom sheet with wallet education)
- FeaturedMarketCard component (extracted from page.tsx with gating logic)
- Updated page.tsx using the new components
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-featured-market-gating/03-CONTEXT.md
@.planning/phases/03-featured-market-gating/03-RESEARCH.md
@src/context/InfoContext.tsx
@src/app/page.tsx
@src/hooks/useTelegram.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WalletGateModal component</name>
  <files>src/components/WalletGateModal.tsx</files>
  <action>
Create a bottom sheet modal component for wallet gating education:

1. Follow the existing pattern from InfoContext.tsx for the bottom sheet animation
2. Use Framer Motion with AnimatePresence for entry/exit animations
3. Structure:
   - Backdrop (fixed, black/60, blur, onClick dismisses)
   - Sheet (fixed bottom, bg-[#121212], rounded-t-3xl, z-[70])
   - Drag handle (w-12 h-1 bg-white/20 centered)
   - Content area with:
     - Wallet icon (yellow-500 in circular bg-yellow-500/10)
     - Title: "Wallet Required"
     - Body: "Connect your TON wallet to access prediction markets. You'll need TON for gas and USDT for trading."
     - Points reward callout: "+1,000 Points" badge (bg-yellow-500/10 border border-yellow-500/20)
     - Primary CTA: "Connect Wallet" (bg-yellow-500 text-black font-bold)
     - Secondary: "Maybe later" (bg-white/5 text-white/60)

4. CRITICAL: In handleConnectWallet, close the modal FIRST (onClose()), THEN call tonConnectUI.openModal() to avoid z-index conflicts

5. Props interface:
   - isOpen: boolean
   - onClose: () => void

6. Use useTonConnectUI hook from @tonconnect/ui-react for programmatic wallet modal

Follow conventions from CONVENTIONS.md:
- 'use client' directive
- PascalCase component name
- Export default
- lucide-react for icons (Wallet, Zap)
  </action>
  <verify>
File exists at src/components/WalletGateModal.tsx with no TypeScript errors:
```bash
npx tsc --noEmit src/components/WalletGateModal.tsx 2>&1 || echo "Check syntax"
```
  </verify>
  <done>
WalletGateModal component exists with:
- Bottom sheet animation matching InfoContext pattern
- Wallet education content with points incentive
- Connect Wallet button that closes modal then triggers TonConnect
- Maybe later dismiss option
  </done>
</task>

<task type="auto">
  <name>Task 2: Create FeaturedMarketCard component</name>
  <files>src/components/FeaturedMarketCard.tsx</files>
  <action>
Extract the Featured Market card from page.tsx into a standalone component with wallet gating:

1. Copy the existing Featured Market JSX from page.tsx (lines 260-278 approximately)
2. Wrap in a component with wallet state detection:
   - Use useTonAddress() from @tonconnect/ui-react
   - const isWalletConnected = !!userFriendlyAddress

3. Add locked state visual indicators when wallet NOT connected:
   - Lock icon (lucide-react Lock) in top-right corner (absolute top-3 right-3)
   - Text below card: "Wallet required to trade" (text-white/30 text-[10px])

4. Add state management:
   - const [showGateModal, setShowGateModal] = useState(false)

5. Handle tap logic:
   - If wallet connected: call onNavigate() prop (external navigation)
   - If NOT connected: setShowGateModal(true)

6. Render WalletGateModal with isOpen={showGateModal} onClose={() => setShowGateModal(false)}

7. Props interface:
   - onNavigate: () => void (called when wallet IS connected and user taps)

8. Keep the card clickable as a button element for accessibility

Follow conventions:
- 'use client' directive
- PascalCase component
- Export default
- Import WalletGateModal from same directory
  </action>
  <verify>
File exists at src/components/FeaturedMarketCard.tsx with no TypeScript errors:
```bash
npx tsc --noEmit src/components/FeaturedMarketCard.tsx 2>&1 || echo "Check syntax"
```
  </verify>
  <done>
FeaturedMarketCard component exists with:
- Extracted market card UI (matches current design)
- Lock indicator when wallet not connected
- "Wallet required" hint text when locked
- Tap triggers WalletGateModal OR onNavigate based on wallet state
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate FeaturedMarketCard into page.tsx</name>
  <files>src/app/page.tsx</files>
  <action>
Update the dashboard page to use the new FeaturedMarketCard:

1. Add import at top:
   ```typescript
   import FeaturedMarketCard from "@/components/FeaturedMarketCard";
   ```

2. Add import for useTelegram if not present (for webApp.openLink):
   - Already imported: const { user, webApp } = useTelegram();

3. Add navigation handler inside Dashboard component:
   ```typescript
   const handleNavigateToMarket = () => {
     const url = 'https://themoon.business';
     if (webApp?.openLink) {
       webApp.openLink(url);
     } else {
       // Fallback for browser dev testing
       window.open(url, '_blank');
     }
   };
   ```

4. Replace the inline Featured Market section (the motion.div containing the card) with:
   ```tsx
   <motion.div variants={item} className="pt-4">
     <div className="flex items-center gap-2 mb-3 px-1">
       <span className="w-1.5 h-1.5 rounded-full bg-blue-500" />
       <h3 className="text-xs font-bold text-white/50 uppercase tracking-widest">Featured Market</h3>
       <InfoTrigger title="Featured Market" content="These are the highest volume markets currently open for analysis. Early positions often yield better returns." />
     </div>
     <FeaturedMarketCard onNavigate={handleNavigateToMarket} />
   </motion.div>
   ```

5. Remove the old inline card JSX (the bg-white/5 border rounded-[24px] div and its contents)

Preserve:
- The motion.div wrapper with variants={item}
- The section header (Featured Market title with InfoTrigger)
- All animation behavior
  </action>
  <verify>
Build succeeds and lint passes:
```bash
cd /Users/tonicaradonna/prediction-early-access && npm run build 2>&1 | head -50
```
  </verify>
  <done>
Dashboard page updated with:
- FeaturedMarketCard component imported and used
- Navigation handler for themoon.business (webApp.openLink with fallback)
- Old inline card markup removed
- Section header preserved with InfoTrigger
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Build verification:
```bash
cd /Users/tonicaradonna/prediction-early-access && npm run build
```

2. Lint verification:
```bash
cd /Users/tonicaradonna/prediction-early-access && npm run lint
```

3. File existence check:
```bash
ls -la src/components/WalletGateModal.tsx src/components/FeaturedMarketCard.tsx
```

4. Import verification:
```bash
grep -n "FeaturedMarketCard" src/app/page.tsx
grep -n "WalletGateModal" src/components/FeaturedMarketCard.tsx
grep -n "useTonAddress" src/components/FeaturedMarketCard.tsx
```
</verification>

<success_criteria>
- [ ] WalletGateModal.tsx exists with bottom sheet pattern
- [ ] FeaturedMarketCard.tsx exists with wallet gating logic
- [ ] page.tsx imports and uses FeaturedMarketCard
- [ ] npm run build succeeds without errors
- [ ] npm run lint passes
- [ ] Lock icon visible when wallet not connected (visual - manual test)
- [ ] Bottom sheet appears on tap when no wallet (visual - manual test)
- [ ] TonConnect modal opens when "Connect Wallet" clicked (visual - manual test)
</success_criteria>

<output>
After completion, create `.planning/phases/03-featured-market-gating/03-01-SUMMARY.md`
</output>
